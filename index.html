<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Stone Products Images</title>
<style>
body{font-family:Arial; background:#f4f6f8; padding:20px;}
h2{margin-bottom:10px;}
button{padding:8px 14px; margin:6px 6px 12px 0; cursor:pointer;}
#tbl{width:100%; border-collapse:collapse; display:grid; grid-template-columns: repeat(auto-fill,minmax(120px,1fr)); gap:10px;}
#tbl td{border:1px solid #ccc; padding:6px; text-align:center; background:#fff;}
img{width:100px; height:100px; object-fit:cover; cursor:pointer; border:1px solid #ddd; margin-bottom:4px;}
input{width:100%; padding:4px; box-sizing:border-box;}
</style>
</head>
<body>

<h2>Stone Products Images</h2>
<button onclick="loadImages()">üìÇ Load Images From Drive</button>
<button onclick="saveAll()">üíæ Save All to Google Sheet</button>

<table id="tbl"><tbody></tbody></table>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyrie65X7KkTZ57lDvoMcP_OCDqup4S0DDQ4vdrigbsRdRUZw-hEunhx6lpS-h5vCI/exec"; // Web App URL
const tbody = document.querySelector("#tbl tbody");

// Add Image Row
function addRow(data={}){
  const r = document.createElement("tr");
  r.innerHTML = `
<td>
  <a target="_blank">
    <img src="" alt="Stone Image">
  </a>
  <input type="hidden" value="${data.id||''}">
  <input type="text" placeholder="Stone Name" value="${data.name||''}">
  <input type="text" placeholder="Uses">
  <input type="text" placeholder="Uses Type">
  <input type="text" placeholder="Surface Type">
  <input type="text" placeholder="Thickness">
  <input type="text" placeholder="Size Type">
  <input type="text" placeholder="Unit Type">
</td>`;
  tbody.appendChild(r);
  if(data.id) setImg(r, data.id);
}

// Set Image Preview and link
function setImg(row,id){
  const img = row.querySelector("img");
  const a = row.querySelector("a");
  img.src = `https://drive.google.com/uc?export=view&id=${id}`;
  a.href = `https://drive.google.com/file/d/${id}/view`;
}

// Load images from Drive
async function loadImages(){
  tbody.innerHTML="<tr><td>Loading images...</td></tr>";
  try{
    const res = await fetch(API_URL+"?mode=images");
    const list = await res.json();
    tbody.innerHTML="";
    list.forEach(f=>addRow({id:f.id,name:f.name}));
  }catch(e){
    alert("‚ùå Images load nahi hui. Web App URL check karo"); console.error(e);
  }
}

// Save all to Sheet
async function saveAll(){
  const rows = [...tbody.querySelectorAll("tr")].map((tr,i)=>{
    const inputs = tr.querySelectorAll("input");
    return {
      sr:i+1,
      image:inputs[0].value,
      stoneName:inputs[1].value,
      uses:inputs[2].value,
      usesType:inputs[3].value,
      surfaceType:inputs[4].value,
      thickness:inputs[5].value,
      sizeType:inputs[6].value,
      unitType:inputs[7].value
    };
  });
  try{
    await fetch(API_URL,{
      method:"POST",
      body:JSON.stringify({rows})
    });
    alert("‚úÖ Data saved to Google Sheet and table updated!");
    loadImages(); // Refresh table
  }catch(e){ alert("‚ùå Save failed"); console.error(e);}
}
</script>

</body>
</html>
