<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Stone Products Table</title>
<style>
body { font-family: Arial; background:#f4f6f8; padding:20px; }
h2 { margin-bottom:10px; }
button { padding:8px 14px; margin:6px 6px 12px 0; cursor:pointer; }
table { width:100%; border-collapse: collapse; background:#fff; }
th, td { border:1px solid #ccc; padding:6px; text-align:center; vertical-align:middle; }
th { background:#2c3e50; color:#fff; position:sticky; top:0; }
input { width:100%; padding:4px; box-sizing:border-box; }
img { width:80px; height:80px; object-fit:cover; cursor:pointer; border:1px solid #ddd; }
td img { display:block; margin:auto; }
</style>
</head>
<body>

<h2>Stone Products Table</h2>
<button onclick="loadImages()">üìÇ Load Images From Drive</button>
<button onclick="saveAll()">üíæ Save All to Google Sheet</button>

<table id="tbl">
<thead>
<tr>
<th>SR</th>
<th>IMAGE</th>
<th>STONE NAME</th>
<th>USES</th>
<th>USES TYPES</th>
<th>SURFACE TYPE</th>
<th>THICKNESS</th>
<th>SIZE TYPE</th>
<th>UNITS TYPE</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyrie65X7KkTZ57lDvoMcP_OCDqup4S0DDQ4vdrigbsRdRUZw-hEunhx6lpS-h5vCI/exec"; // Web App URL
const tbody = document.querySelector("#tbl tbody");

// Add row
function addRow(data={}){
  const r = tbody.insertRow();
  const sr = tbody.rows.length;
  r.innerHTML = `
<td>${sr}</td>
<td>
  <a target="_blank">
    <img src="" alt="Stone Image">
  </a>
  <input type="hidden" value="${data.id||''}">
</td>
<td><input value="${data.name||''}"></td>
<td><input></td>
<td><input></td>
<td><input></td>
<td><input></td>
<td><input></td>
<td><input></td>
`;
  if(data.id) setImg(r, data.id);
}

// Set image
function setImg(row, id){
  const img = row.querySelector("img");
  const a = row.querySelector("a");
  img.src = `https://drive.google.com/uc?export=view&id=${id}`;
  a.href = `https://drive.google.com/file/d/${id}/view`;
}

// Load images from Drive
async function loadImages(){
  tbody.innerHTML="<tr><td colspan='9'>Loading images...</td></tr>";
  try{
    const res = await fetch(API_URL+"?mode=images");
    const list = await res.json();
    tbody.innerHTML="";
    list.forEach(f=>addRow({id:f.id,name:''})); // Name hidden
  }catch(e){
    alert("‚ùå Images load nahi hui. Web App URL check karo"); console.error(e);
  }
}

// Save all to Sheet
async function saveAll(){
  const rows = [...tbody.rows].map((row,i)=>{
    const inputs = row.querySelectorAll("input");
    return {
      sr:i+1,
      image:inputs[0].value,
      stoneName:inputs[1].value,
      uses:inputs[2].value,
      usesType:inputs[3].value,
      surfaceType:inputs[4].value,
      thickness:inputs[5].value,
      sizeType:inputs[6].value,
      unitType:inputs[7].value
    };
  });
  try{
    await fetch(API_URL,{
      method:"POST",
      body:JSON.stringify({rows})
    });
    alert("‚úÖ Data saved to Google Sheet!");
  }catch(e){ alert("‚ùå Save failed"); console.error(e);}
}
</script>
</body>
</html>
