<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Stone Products Details</title>

<style>
body { font-family: Arial; background:#f4f6f8; padding:20px; }
table { width:100%; border-collapse:collapse; background:#fff; }
th, td { border:1px solid #ccc; padding:6px; text-align:center; }
th { background:#2c3e50; color:#fff; position:sticky; top:0; }
input { width:100%; border:none; padding:4px; }
img { width:60px; height:60px; object-fit:cover; cursor:pointer; }
button { padding:8px 14px; margin:6px; }
</style>
</head>

<body>

<h2>Stone Products Details</h2>

<button onclick="loadImages()">ðŸ“‚ Load Images From Drive</button>
<button onclick="saveAll()">ðŸ’¾ Save to Google Drive</button>

<table id="tbl">
<thead>
<tr>
<th>SR</th>
<th>IMAGE</th>
<th>STONE NAME</th>
<th>USES</th>
<th>USES TYPES</th>
<th>SURFACE TYPE</th>
<th>THICKNESS</th>
<th>SIZE TYPE</th>
<th>UNITS TYPE</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
const API_URL = "https://script.google.com/macros/s/1crOovIUdMuNNWGxZRivMVQ9YRIqWCH_aPeNxXCR26_EvVD7S_19AyYKT/exec";
const tbody = document.querySelector("#tbl tbody");

// ================= ADD ROW =================
function addRow(d = {}) {
  const r = tbody.insertRow();
  r.innerHTML = `
<td>${tbody.rows.length}</td>
<td>
  <input placeholder="Drive Image ID" value="${d.image || ''}" oninput="updateImg(this)">
  <br>
  <a target="_blank"><img></a>
</td>
<td><input value="${d.name || ''}"></td>
<td><input></td>
<td><input></td>
<td><input></td>
<td><input></td>
<td><input></td>
<td><input></td>
`;
  if (d.image) setImg(r.cells[1], d.image);
}

// ================= IMAGE HANDLING =================
function updateImg(inp) {
  setImg(inp.parentElement, inp.value);
}

function setImg(cell, id) {
  const img = cell.querySelector("img");
  const a = cell.querySelector("a");
  img.src = `https://drive.google.com/uc?id=${id}`;
  a.href = `https://drive.google.com/file/d/${id}/view`;
}

// ================= LOAD DRIVE IMAGES =================
function loadImages() {
  fetch(API_URL + "?mode=images")
    .then(r => r.json())
    .then(list => {
      tbody.innerHTML = "";
      list.forEach(img => addRow({ image: img.id, name: img.name }));
    });
}

// ================= SAVE TO DRIVE =================
function saveAll() {
  [...tbody.rows].forEach(row => {
    const data = {
      image: row.cells[1].querySelector("input").value,
      name: row.cells[2].querySelector("input").value,
      uses: row.cells[3].querySelector("input").value,
      useType: row.cells[4].querySelector("input").value,
      surface: row.cells[5].querySelector("input").value,
      thickness: row.cells[6].querySelector("input").value,
      size: row.cells[7].querySelector("input").value,
      unit: row.cells[8].querySelector("input").value
    };

    fetch(API_URL, {
      method: "POST",
      body: JSON.stringify(data)
    });
  });

  alert("âœ… Data Google Drive Sheet me save ho gaya");
}
</script>

</body>
</html>
